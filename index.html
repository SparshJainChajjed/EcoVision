<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Zero-Setup E-Waste Detector</title>
  <!-- ml5.js bundles TensorFlow.js + COCO-SSD for you -->
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align:center; padding:2rem }
    canvas, img { max-width:100%; margin-top:1rem }
    #status { margin-top:1rem }
  </style>
</head>
<body>
  <h1>Zero-Setup E-Waste Detector</h1>
  <p>Only detects phones, laptops, remotes, TVs, keyboards, mice…</p>
  <input type="file" id="picker" accept="image/*"><br>
  <canvas id="canvas"></canvas>
  <div id="status">Loading model…</div>

  <script>
    let detector, imgEl, ctx, canvas, status;
    async function init() {
      status = document.getElementById('status');
      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');
      detector = await ml5.objectDetector('cocossd');
      status.textContent = 'Model ready—pick an image!';
      document.getElementById('picker').addEventListener('change', handleFile);
    }

    async function handleFile(e) {
      const file = e.target.files[0];
      if (!file) return;
      status.textContent = 'Detecting…';
      imgEl = new Image();
      imgEl.src = URL.createObjectURL(file);
      await new Promise(r => imgEl.onload = r);

      canvas.width = imgEl.width;
      canvas.height = imgEl.height;
      ctx.drawImage(imgEl, 0, 0);

      detector.detect(imgEl, (err, results) => {
        if (err) {
          status.textContent = 'Error: ' + err.message;
          return;
        }
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#0f0';
        ctx.font = '16px sans-serif';
        results.forEach(r => {
          if (!['cell phone','laptop','remote','keyboard','mouse','tv'].includes(r.label)) return;
          const [x,y,w,h] = r.x, r.y, r.width, r.height;
          ctx.strokeRect(r.x, r.y, r.width, r.height);
          ctx.fillText(`${r.label} ${(r.confidence*100).toFixed(1)}%`, r.x, r.y>20?r.y-5:r.y+20);
        });
        status.textContent = 'Done.';
      });
    }

    init();
  </script>
</body>
</html>
