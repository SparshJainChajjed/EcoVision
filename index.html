<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoRecycle - E-Waste Detection & Recycling</title>
    <style>
        :root {
            --primary: #4CAF50;
            --primary-dark: #388E3C;
            --secondary: #2196F3;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #757575;
            --danger: #f44336;
            --success: #4CAF50;
            --warning: #FF9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f9f9f9;
            color: var(--dark);
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
        }

        .hero {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1580983218784-0c6593f304b9?ixlib=rb-4.0.3') no-repeat center center/cover;
            height: 60vh;
            display: flex;
            align-items: center;
            text-align: center;
            color: white;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }

        .btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin: 5px;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #0b7dda;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #e68a00;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        section {
            padding: 3rem 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-title h2 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .app-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1.5rem;
            position: relative; /* For loading spinner positioning */
        }

        .upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(76, 175, 80, 0.05);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--gray);
            margin-bottom: 1rem;
            display: block;
        }

        .upload-area p {
            margin: 0.5rem 0;
        }

        .device-info {
            background: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .device-image {
            max-width: 200px;
            margin: 0 auto 1rem;
            display: block;
            border-radius: 5px;
        }

        .value-info {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }

        .value-box {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            flex: 1;
            min-width: 150px;
            margin: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .value-box h4 {
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .value-box p {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .options {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 2rem 0;
        }

        .option-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            flex: 1;
            min-width: 250px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .option-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .option-card.selected {
            border-color: var(--primary);
            background-color: rgba(76, 175, 80, 0.1);
        }

        .option-card i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        .service-info {
            background: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }

        .service-info h3 {
            margin-bottom: 1rem;
            text-align: center;
        }

        .delivery-options {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .delivery-option {
            background: white;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            flex: 1;
            min-width: 150px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .delivery-option:hover {
            border-color: var(--secondary);
        }

        .delivery-option.selected {
            border-color: var(--secondary);
            background-color: rgba(33, 150, 243, 0.1);
        }

        .guide-steps {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }

        .guide-steps li {
            counter-increment: step-counter;
            margin-bottom: 1.5rem;
            padding-left: 3rem;
            position: relative;
        }

        .guide-steps li:before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            background: var(--primary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }

        .progress-bar:before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
            z-index: 1;
        }

        .progress-fill {
            position: absolute;
            top: 15px;
            left: 0;
            height: 4px;
            background: var(--primary);
            z-index: 2;
            transition: width 0.5s ease;
        }

        .progress-step {
            text-align: center;
            position: relative;
            z-index: 3;
            flex: 1;
        }

        .progress-step .step-icon {
            width: 35px;
            height: 35px;
            background: #e0e0e0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            color: white;
            font-weight: bold;
        }

        .progress-step.active .step-icon {
            background: var(--primary);
        }

        .progress-step.completed .step-icon {
            background: var(--success);
        }

        .progress-step .step-label {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .progress-step.active .step-label {
            color: var(--primary);
            font-weight: 500;
        }

        footer {
            background: var(--dark);
            color: white;
            padding: 2rem 0 1rem;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .result-message {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            text-align: center;
        }

        .success-message {
            background-color: #e8f5e9;
            color: var(--success);
            border: 1px solid var(--success);
        }

        .error-message {
            background-color: #ffebee;
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .cv-results {
            background: #e3f2fd;
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.8rem;
        }

        .cv-results h4 {
            margin-top: 0;
            color: var(--secondary);
        }

        @media (max-width: 768px) {
            .hero {
                height: 50vh;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .app-container {
                padding: 1.5rem;
            }

            .options, .delivery-options {
                flex-direction: column;
                align-items: center;
            }

            .option-card, .delivery-option {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <i>♻️</i> EcoRecycle
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Recycle Your E-Waste Responsibly</h1>
                <p>Upload a photo of your old device and we'll help you recycle it easily and responsibly using AI.</p>
            </div>
        </div>
    </section>

    <!-- Main App Section -->
    <section>
        <div class="container">
            <div class="section-title">
                <h2>E-Waste Recycling Process</h2>
                <p>Follow these simple steps to recycle your old electronics</p>
            </div>

            <div class="app-container">
                <!-- Progress Bar -->
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                    <div class="progress-step active" data-step="1">
                        <div class="step-icon">1</div>
                        <div class="step-label">Upload</div>
                    </div>
                    <div class="progress-step" data-step="2">
                        <div class="step-icon">2</div>
                        <div class="step-label">Identify</div>
                    </div>
                    <div class="progress-step" data-step="3">
                        <div class="step-icon">3</div>
                        <div class="step-label">Value</div>
                    </div>
                    <div class="progress-step" data-step="4">
                        <div class="step-icon">4</div>
                        <div class="step-label">Options</div>
                    </div>
                    <div class="progress-step" data-step="5">
                        <div class="step-icon">5</div>
                        <div class="step-label">Recycle</div>
                    </div>
                </div>

                <!-- Step 1: Upload -->
                <div class="step active" id="step1">
                    <h3>Upload Your Device Photo</h3>
                    <p>Take a clear photo of your old electronic device and upload it below.</p>

                    <div class="upload-area" id="uploadArea">
                        <i>📷</i>
                        <p>Click to upload or drag & drop your image here</p>
                        <p class="small">(JPG, PNG, or GIF)</p>
                        <input type="file" id="fileInput" accept="image/*" class="hidden">
                    </div>

                    <div id="uploadMessage" class="result-message hidden"></div>

                    <div style="text-align: center; margin-top: 1rem;">
                        <button class="btn" id="nextToIdentify" disabled>Analyze with AI</button>
                    </div>
                </div>

                <!-- Step 2: Identify -->
                <div class="step" id="step2">
                    <h3>Device Identification</h3>
                    <p>Our AI system is analyzing your image...</p>

                    <div class="device-info">
                        <img src="" alt="Device" class="device-image" id="deviceImage">
                        <h3 id="deviceName">Analyzing image...</h3>
                        <p id="deviceDescription">Please wait while we process your image.</p>
                        <div id="cvResults" class="cv-results hidden">
                            <h4>AI Detection Results:</h4>
                            <pre id="cvResultsText">Processing...</pre>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 1rem;">
                        <button class="btn" id="backToUpload">Back</button>
                        <button class="btn btn-secondary" id="nextToValue" disabled>Next: Check Value</button>
                    </div>
                </div>

                <!-- Step 3: Value -->
                <div class="step" id="step3">
                    <h3>Value Estimation</h3>
                    <p>Here's the value information for your device:</p>

                    <div class="value-info">
                        <div class="value-box">
                            <h4>Original Value</h4>
                            <p id="originalValue">₹ --</p>
                        </div>
                        <div class="value-box">
                            <h4>Current Worth</h4>
                            <p id="currentValue">₹ --</p>
                        </div>
                        <div class="value-box">
                            <h4>Recycling Option</h4>
                            <p id="recyclingValue">₹ --</p>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 1rem;">
                        <button class="btn" id="backToIdentify">Back</button>
                        <button class="btn btn-secondary" id="nextToOptions">Next: Recycling Options</button>
                    </div>
                </div>

                <!-- Step 4: Options -->
                <div class="step" id="step4">
                    <h3>Recycling Options</h3>
                    <p>Choose how you'd like to recycle your device:</p>

                    <div class="options">
                        <div class="option-card" id="optionDonate">
                            <i>🎁</i>
                            <h3>Donate for Free</h3>
                            <p>Support local NGOs by donating your device for free.</p>
                            <p><strong>Location: Bangalore</strong></p>
                        </div>
                        <div class="option-card" id="optionRecycle">
                            <i>💰</i>
                            <h3>Recycle for Money</h3>
                            <p>Get paid by certified recycling companies.</p>
                            <p><strong>Partner: Zolopik Recycling</strong></p>
                        </div>
                    </div>

                    <div style="text-align: center; margin-top: 1rem;">
                        <button class="btn" id="backToValue">Back</button>
                        <button class="btn btn-secondary" id="nextToRecycle" disabled>Next: Proceed to Recycle</button>
                    </div>
                </div>

                <!-- Step 5: Recycle -->
                <div class="step" id="step5">
                    <h3>Complete Your Recycling</h3>
                    <p id="selectedOptionTitle">You have selected to recycle your device.</p>

                    <div class="service-info">
                        <h3 id="serviceName">Service Provider</h3>
                        <p id="serviceDetails">Details about the service will appear here.</p>

                        <h4 style="margin-top: 1.5rem;">Choose Delivery Method:</h4>
                        <div class="delivery-options">
                            <div class="delivery-option" id="pickupOption">
                                <i>🚚</i>
                                <h4>Pickup</h4>
                                <p>Schedule a pickup at your convenience</p>
                            </div>
                            <div class="delivery-option" id="deliveryOption">
                                <i>📍</i>
                                <h4>Drop-off</h4>
                                <p>Visit our recycling center</p>
                            </div>
                        </div>
                    </div>

                    <div id="recyclingGuide" class="hidden">
                        <h3>Recycling Guide</h3>
                        <p>Follow these steps to complete the process:</p>
                        <ol class="guide-steps">
                            <li id="step1Guide">Schedule your pickup or prepare for drop-off</li>
                            <li id="step2Guide">Package your device securely</li>
                            <li id="step3Guide">Hand over the device to our partner</li>
                            <li id="step4Guide">Receive confirmation and payment (if applicable)</li>
                        </ol>
                    </div>

                    <div style="text-align: center; margin-top: 1rem;">
                        <button class="btn" id="backToOptions">Back</button>
                        <button class="btn btn-secondary" id="completeProcess" disabled>Complete Process</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2023 EcoRecycle. Helping reduce e-waste in India, one device at a time.</p>
        </div>
    </footer>

    <script>
        // Simulated database of devices for fallback
        const deviceDatabase = [
            {
                name: "Samsung Galaxy S8",
                description: "Released in 2017, Android smartphone with 64GB storage",
                image: "https://placehold.co/200x200/4CAF50/FFFFFF?text=Galaxy+S8",
                originalValue: 55000,
                currentValue: 3000
            },
            {
                name: "iPhone 7",
                description: "Released in 2016, iOS smartphone with 32GB storage",
                image: "https://placehold.co/200x200/2196F3/FFFFFF?text=iPhone+7",
                originalValue: 60000,
                currentValue: 4000
            },
            {
                name: "iPad Air 2",
                description: "Released in 2014, 16GB Wi-Fi model",
                image: "https://placehold.co/200x200/FF9800/FFFFFF?text=iPad+Air+2",
                originalValue: 35000,
                currentValue: 2500
            },
            {
                name: "Dell Inspiron Laptop",
                description: "5000 series, 15.6-inch, Intel Core i5, 8GB RAM",
                image: "https://placehold.co/200x200/9C27B0/FFFFFF?text=Dell+Inspiron",
                originalValue: 45000,
                currentValue: 5000
            },
            {
                name: "Sony PlayStation 4",
                description: "500GB model, released in 2013",
                image: "https://placehold.co/200x200/F44336/FFFFFF?text=PS4",
                originalValue: 25000,
                currentValue: 3000
            }
        ];

        // DOM Elements
        const steps = document.querySelectorAll('.step');
        const progressFill = document.getElementById('progressFill');
        const progressSteps = document.querySelectorAll('.progress-step');

        // Upload elements
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const nextToIdentify = document.getElementById('nextToIdentify');
        const uploadMessage = document.getElementById('uploadMessage');

        // Identify elements
        const deviceImage = document.getElementById('deviceImage');
        const deviceName = document.getElementById('deviceName');
        const deviceDescription = document.getElementById('deviceDescription');
        const cvResults = document.getElementById('cvResults');
        const cvResultsText = document.getElementById('cvResultsText');

        // Value elements
        const originalValue = document.getElementById('originalValue');
        const currentValue = document.getElementById('currentValue');
        const recyclingValue = document.getElementById('recyclingValue');

        // Options elements
        const optionDonate = document.getElementById('optionDonate');
        const optionRecycle = document.getElementById('optionRecycle');
        const nextToRecycle = document.getElementById('nextToRecycle');

        // Recycle elements
        const selectedOptionTitle = document.getElementById('selectedOptionTitle');
        const serviceName = document.getElementById('serviceName');
        const serviceDetails = document.getElementById('serviceDetails');
        const pickupOption = document.getElementById('pickupOption');
        const deliveryOption = document.getElementById('deliveryOption');
        const recyclingGuide = document.getElementById('recyclingGuide');
        const completeProcess = document.getElementById('completeProcess');

        // Navigation buttons
        const backToUpload = document.getElementById('backToUpload');
        const nextToValue = document.getElementById('nextToValue');
        const backToIdentify = document.getElementById('backToIdentify');
        const nextToOptions = document.getElementById('nextToOptions');
        const backToValue = document.getElementById('backToValue');
        const backToOptions = document.getElementById('backToOptions');

        // State
        let currentStep = 1;
        let selectedDevice = null;
        let selectedOption = null;
        let selectedDelivery = null;
        let uploadedImage = null;

        // Hugging Face API Configuration - YOUR KEY IS INTEGRATED HERE
        const HF_API_URL = "https://api-inference.huggingface.co/models/facebook/detr-resnet-50";
        const HF_API_TOKEN = "hf_eqpwbezpYLVZD1wwIZSTaxIULNEDJLvaUA"; // YOUR API KEY FROM SCREENSHOT

        // Event Listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileUpload);
        nextToIdentify.addEventListener('click', analyzeWithAI);
        backToUpload.addEventListener('click', () => goToStep(1));
        nextToValue.addEventListener('click', () => goToStep(3));
        backToIdentify.addEventListener('click', () => goToStep(2));
        nextToOptions.addEventListener('click', () => goToStep(4));
        backToValue.addEventListener('click', () => goToStep(3));
        nextToRecycle.addEventListener('click', () => goToStep(5));
        backToOptions.addEventListener('click', () => goToStep(4));
        completeProcess.addEventListener('click', finishProcess);

        optionDonate.addEventListener('click', () => selectOption('donate'));
        optionRecycle.addEventListener('click', () => selectOption('recycle'));

        pickupOption.addEventListener('click', () => selectDelivery('pickup'));
        deliveryOption.addEventListener('click', () => selectDelivery('delivery'));

        // Functions
        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (file) {
                // Show upload success message
                uploadMessage.textContent = `Uploaded: ${file.name}`;
                uploadMessage.className = 'result-message success-message';
                uploadMessage.classList.remove('hidden');

                // Store the uploaded image for later use
                uploadedImage = file;

                // Enable next button
                nextToIdentify.disabled = false;
            }
        }

        async function analyzeWithAI() {
            if (!uploadedImage) {
                alert("Please upload an image first.");
                return;
            }

            goToStep(2); // Move to identification step

            try {
                // Show loading state
                deviceName.innerHTML = '<span class="loading"></span> Analyzing with AI...';
                deviceDescription.textContent = "This may take a few seconds. Please wait.";
                cvResults.classList.add('hidden');

                // Convert image to base64 for sending to API
                const base64Image = await fileToBase64(uploadedImage);

                // Call Hugging Face API
                const response = await fetch(HF_API_URL, {
                    headers: {
                        "Authorization": `Bearer ${HF_API_TOKEN}`,
                        "Content-Type": "application/json"
                    },
                    method: "POST",
                    body: JSON.stringify({ inputs: base64Image.split(',')[1] }) // Remove image prefix
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();

                // Display raw results for debugging (hidden by default)
                cvResultsText.textContent = JSON.stringify(result, null, 2);
                // cvResults.classList.remove('hidden'); // Uncomment to show raw results

                // Process results to find the most likely electronic device
                // This is a simplified interpretation - a real model would be trained specifically for e-waste
                let bestMatch = null;
                let highestScore = 0;

                if (Array.isArray(result)) {
                    for (const detection of result) {
                        // Filter for common electronic device categories
                        if (detection.label &&
                            (detection.label.includes('cell phone') ||
                             detection.label.includes('laptop') ||
                             detection.label.includes('computer') ||
                             detection.label.includes('tv') ||
                             detection.label.includes('monitor') ||
                             detection.label.includes('keyboard') ||
                             detection.label.includes('mouse'))) {

                            if (detection.score > highestScore) {
                                highestScore = detection.score;
                                bestMatch = detection.label;
                            }
                        }
                    }
                }

                if (bestMatch && highestScore > 0.3) { // Confidence threshold
                    // Find a matching device in our database
                    const matchedDevice = deviceDatabase.find(device =>
                        device.name.toLowerCase().includes(bestMatch.split(' ')[0]) || // Match first word
                        device.description.toLowerCase().includes(bestMatch)
                    );

                    if (matchedDevice) {
                        selectedDevice = matchedDevice;
                    } else {
                        // Fallback to a random device if no match found, but use AI detection info
                        selectedDevice = deviceDatabase[Math.floor(Math.random() * deviceDatabase.length)];
                        selectedDevice.name = `Detected: ${bestMatch}`;
                        selectedDevice.description = `AI Confidence: ${(highestScore * 100).toFixed(1)}%`;
                    }
                } else {
                    // Fallback if AI doesn't find a confident match
                    selectedDevice = deviceDatabase[Math.floor(Math.random() * deviceDatabase.length)];
                    selectedDevice.name = "General Electronic Device";
                    selectedDevice.description = "AI could not identify a specific device type. Showing general estimation.";
                }

                // Update UI with identified device
                updateDeviceDisplay();

                // Enable next button
                nextToValue.disabled = false;

            } catch (error) {
                console.error("AI Analysis Error:", error);
                deviceName.textContent = "Analysis Failed";
                deviceDescription.textContent = `Error: ${error.message}. Using simulation.`;

                // Fallback to simulation on error after a delay
                setTimeout(() => {
                    selectedDevice = deviceDatabase[Math.floor(Math.random() * deviceDatabase.length)];
                    updateDeviceDisplay();
                    nextToValue.disabled = false;
                }, 1500);
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function updateDeviceDisplay() {
            if (selectedDevice) {
                deviceImage.src = selectedDevice.image;
                deviceName.textContent = selectedDevice.name;
                deviceDescription.textContent = selectedDevice.description;

                // Update values
                originalValue.textContent = `₹${selectedDevice.originalValue.toLocaleString()}`;
                currentValue.textContent = `₹${selectedDevice.currentValue.toLocaleString()}`;
                recyclingValue.textContent = `₹${Math.floor(selectedDevice.currentValue * 0.7).toLocaleString()}`;
            }
        }

        function selectOption(option) {
            selectedOption = option;

            // Update UI to show selection
            optionDonate.classList.remove('selected');
            optionRecycle.classList.remove('selected');

            if (option === 'donate') {
                optionDonate.classList.add('selected');
            } else if (option === 'recycle') {
                optionRecycle.classList.add('selected');
            }

            // Enable next button
            nextToRecycle.disabled = false;
        }

        function selectDelivery(delivery) {
            selectedDelivery = delivery;

            // Update UI to show selection
            pickupOption.classList.remove('selected');
            deliveryOption.classList.remove('selected');

            if (delivery === 'pickup') {
                pickupOption.classList.add('selected');
            } else if (delivery === 'delivery') {
                deliveryOption.classList.add('selected');
            }

            // Show recycling guide
            recyclingGuide.classList.remove('hidden');

            // Enable complete button
            completeProcess.disabled = false;
        }

        function updateRecycleStep() {
            if (selectedOption === 'donate') {
                selectedOptionTitle.textContent = "You have selected to donate your device for free.";
                serviceName.textContent = "NGO Partner: TechForGood Foundation";
                serviceDetails.textContent = "Your device will be donated to support digital literacy programs in underserved communities in Bangalore.";
                document.getElementById('step1Guide').textContent = "Schedule a free pickup at your convenience";
                document.getElementById('step2Guide').textContent = "Package your device securely";
                document.getElementById('step3Guide').textContent = "Hand over the device to our NGO partner";
                document.getElementById('step4Guide').textContent = "Receive a donation receipt via email";
            } else if (selectedOption === 'recycle') {
                selectedOptionTitle.textContent = "You have selected to recycle your device for money.";
                serviceName.textContent = "Recycling Partner: Zolopik Recycling";
                serviceDetails.textContent = "You will receive ₹" + Math.floor(selectedDevice.currentValue * 0.7).toLocaleString() + " for your device. Payment will be processed after quality check.";
                document.getElementById('step1Guide').textContent = "Schedule your pickup or visit our recycling center";
                document.getElementById('step2Guide').textContent = "Package your device securely";
                document.getElementById('step3Guide').textContent = "Hand over the device to our recycling partner";
                document.getElementById('step4Guide').textContent = "Receive payment via UPI or bank transfer";
            }
        }

        function goToStep(step) {
            // Hide all steps
            steps.forEach(s => s.classList.remove('active'));

            // Show current step
            document.getElementById(`step${step}`).classList.add('active');

            // Update progress bar
            progressSteps.forEach((ps, index) => {
                const stepNum = index + 1;
                ps.classList.remove('active', 'completed');

                if (stepNum < step) {
                    ps.classList.add('completed');
                } else if (stepNum === step) {
                    ps.classList.add('active');
                }
            });

            // Update progress fill width
            const progressPercentage = ((step - 1) / 4) * 100;
            progressFill.style.width = `${progressPercentage}%`;

            // Update state
            currentStep = step;

            // Special actions for certain steps
            if (step === 2 && selectedDevice) {
                updateDeviceDisplay();
            } else if (step === 5) {
                updateRecycleStep();
            }
        }

        function finishProcess() {
            alert(`Thank you for recycling your ${selectedDevice.name}!\n\nYour request has been submitted. A representative will contact you soon to finalize the details.`);
            // Reset the process
            resetProcess();
        }

        function resetProcess() {
            // Reset state
            currentStep = 1;
            selectedDevice = null;
            selectedOption = null;
            selectedDelivery = null;
            uploadedImage = null;

            // Reset UI
            fileInput.value = '';
            uploadMessage.classList.add('hidden');
            nextToIdentify.disabled = true;
            nextToValue.disabled = true;
            optionDonate.classList.remove('selected');
            optionRecycle.classList.remove('selected');
            nextToRecycle.disabled = true;
            pickupOption.classList.remove('selected');
            deliveryOption.classList.remove('selected');
            recyclingGuide.classList.add('hidden');
            completeProcess.disabled = true;
            cvResults.classList.add('hidden');

            // Go to first step
            goToStep(1);
        }

        // Initialize the app
        resetProcess();
    </script>
</body>
</html>
