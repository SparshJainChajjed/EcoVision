import os, shutil, zipfile, pathlib, textwrap, json

base = "/mnt/data/e-waste-gh-pages"
os.makedirs(base, exist_ok=True)

index_html = """<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>E‑Waste Recycling App</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <header>
    <h1>E‑Waste Recycling</h1>
  </header>
  <main>
    <section class="hero">
      <h2>Turn Old Gadgets Into Good</h2>
      <p>Identify a device from a photo, see its value, and recycle it responsibly.</p>
    </section>

    <section class="card">
      <h3>Identify Your Device</h3>
      <div class="uploader">
        <input id="imageInput" type="file" accept="image/*" />
        <button id="identifyBtn" class="button">Identify</button>
      </div>
      <div class="preview-wrap">
        <img id="preview" alt="preview" />
      </div>
      <p id="modelStatus" class="note">Loading on‑device model…</p>
    </section>

    <section id="resultSection" class="card result">
      <h3>Result</h3>
      <p>Device: <strong id="deviceName">—</strong></p>
      <p>Original value: <strong id="originalValue">—</strong></p>
      <p>Current value: <strong id="currentValue">—</strong></p>
    </section>

    <section id="recycleSection" class="card recycle">
      <h3>Recycle it?</h3>
      <div class="buttons">
        <button id="recycleBtn" class="button">Yes, recycle</button>
        <a href="#" id="skipBtn" class="button ghost">No, maybe later</a>
      </div>
      <p id="locationStatus" class="note"></p>
      <div id="manualLocation" class="manual-location">
        <label for="cityInput">Enter your city</label>
        <input id="cityInput" placeholder="City name" />
      </div>
    </section>

    <section id="optionsSection" class="card options">
      <h3>Choose an option</h3>
      <div class="grid2">
        <a class="option-link" href="guide_donation.html">Donate to NGO (free)</a>
        <a class="option-link" href="guide_recycle.html">Recycle with company (for cash)</a>
      </div>
    </section>
  </main>
  <footer>
    <p>© 2025 E‑Waste App</p>
  </footer>
</body>
</html>
"""

style_css = """*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0b0f14;--card:#121821;--muted:#8aa0b6;--text:#e8f1ff;--accent:#58d68d;--accent2:#20b2aa}
html,body{height:100%}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b0f14,#0c1117 40%,#0b0f14);color:var(--text);display:flex;flex-direction:column}
header{padding:18px 16px;position:sticky;top:0;z-index:10;background:rgba(9,13,19,.6);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
header h1{font-size:20px}
main{width:min(1080px,92%);margin:24px auto 42px;display:grid;gap:18px}
.hero{padding:28px;border:1px solid rgba(255,255,255,.06);background:radial-gradient(1200px 500px at 10% -10%,rgba(88,214,141,.12),transparent),radial-gradient(900px 400px at 100% 10%,rgba(32,178,170,.12),transparent),var(--card);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.hero h2{font-size:34px;font-weight:800;margin-bottom:6px}
.hero p{color:var(--muted)}
.card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
.uploader{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
input[type=file]{padding:10px;border:1px dashed rgba(255,255,255,.25);border-radius:12px;background:#0e141b;color:var(--text)}
.button{display:inline-block;padding:12px 16px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#0b0f14;font-weight:700;border:none;cursor:pointer;text-decoration:none}
.button.ghost{background:transparent;border:1px solid rgba(255,255,255,.14);color:var(--text)}
.note{color:var(--muted);font-size:14px;margin-top:8px}
.preview-wrap{margin-top:12px;display:flex;justify-content:flex-start}
#preview{max-width:320px;max-height:220px;border-radius:12px;border:1px solid rgba(255,255,255,.08);display:none}
.result,.recycle,.options{display:none}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.option-link{display:block;text-align:center;padding:14px 16px;border-radius:12px;background:#0e141b;border:1px solid rgba(255,255,255,.14);color:var(--text);text-decoration:none}
.option-link:hover{border-color:rgba(255,255,255,.28)}
.manual-location{display:none;margin-top:10px}
label{display:block;margin-bottom:6px;font-weight:600}
input[type=text],input[type=search]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:#0e141b;color:var(--text)}
footer{margin-top:auto;padding:20px;color:var(--muted);text-align:center;border-top:1px solid rgba(255,255,255,.06);background:rgba(9,13,19,.4)}
@media (max-width:820px){.grid2{grid-template-columns:1fr} .hero h2{font-size:26px} #preview{max-width:100%;max-height:260px}}
"""

script_js = """let model, imageDataUrl=null;
const sampleDevices=[
  {name:"Smartphone",originalValue:"₹50,000",currentValue:"₹5,000"},
  {name:"Laptop",originalValue:"₹70,000",currentValue:"₹15,000"},
  {name:"Tablet",originalValue:"₹30,000",currentValue:"₹7,000"},
  {name:"Desktop PC",originalValue:"₹40,000",currentValue:"₹8,000"}
];
const modelStatus=document.getElementById("modelStatus");
const imageInput=document.getElementById("imageInput");
const identifyBtn=document.getElementById("identifyBtn");
const preview=document.getElementById("preview");
const resultSection=document.getElementById("resultSection");
const deviceNameEl=document.getElementById("deviceName");
const originalValueEl=document.getElementById("originalValue");
const currentValueEl=document.getElementById("currentValue");
const recycleSection=document.getElementById("recycleSection");
const optionsSection=document.getElementById("optionsSection");
const recycleBtn=document.getElementById("recycleBtn");
const skipBtn=document.getElementById("skipBtn");
const locationStatus=document.getElementById("locationStatus");
const manualLocation=document.getElementById("manualLocation");

function mapToCategory(label){
  const l=label.toLowerCase();
  if(l.includes("laptop")||l.includes("notebook")) return "Laptop";
  if(l.includes("cellular")||l.includes("mobile")||l.includes("smartphone")||l.includes("telephone")||l.includes("ipod")) return "Smartphone";
  if(l.includes("monitor")||l.includes("desktop")||l.includes("screen")) return "Desktop PC";
  if(l.includes("tablet")||l.includes("ipad")||l.includes("book jacket")) return "Tablet";
  return null;
}
function pickDeviceFor(label){
  const mapped=mapToCategory(label);
  if(mapped){
    return sampleDevices.find(d=>d.name===mapped);
  }
  return sampleDevices[Math.floor(Math.random()*sampleDevices.length)];
}
async function ensureModel(){
  if(!model){
    modelStatus.textContent="Loading on‑device model…";
    model=await mobilenet.load();
    modelStatus.textContent="Model ready.";
  }
}
imageInput.addEventListener("change",()=>{
  const f=imageInput.files[0];
  if(!f){preview.style.display="none";imageDataUrl=null;return;}
  const reader=new FileReader();
  reader.onload=e=>{imageDataUrl=e.target.result;preview.src=imageDataUrl;preview.style.display="block";};
  reader.readAsDataURL(f);
});
identifyBtn.addEventListener("click",async()=>{
  if(!imageDataUrl){modelStatus.textContent="Please choose an image first.";return;}
  await ensureModel();
  modelStatus.textContent="Identifying…";
  await new Promise(r=>setTimeout(r,50));
  const p=await model.classify(preview);
  const top=p&&p[0]?p[0].className:"unknown";
  const device=pickDeviceFor(top);
  deviceNameEl.textContent=device.name;
  originalValueEl.textContent=device.originalValue;
  currentValueEl.textContent=device.currentValue;
  resultSection.style.display="block";
  recycleSection.style.display="block";
  modelStatus.textContent="Done.";
});
recycleBtn.addEventListener("click",()=>{
  if("geolocation" in navigator){
    locationStatus.textContent="Detecting your location…";
    navigator.geolocation.getCurrentPosition(
      pos=>{
        const {latitude,longitude}=pos.coords;
        locationStatus.textContent=`Location detected (${latitude.toFixed(2)}, ${longitude.toFixed(2)}).`;
        optionsSection.style.display="block";
      },
      err=>{
        locationStatus.textContent="Unable to get location. Enter city manually below.";
        manualLocation.style.display="block";
        optionsSection.style.display="block";
      }
    );
  }else{
    locationStatus.textContent="Geolocation not supported. Enter city manually below.";
    manualLocation.style.display="block";
    optionsSection.style.display="block";
  }
});
skipBtn.addEventListener("click",(e)=>{
  e.preventDefault();
  resultSection.style.display="none";
  recycleSection.style.display="none";
  optionsSection.style.display="none";
  preview.style.display="none";
  imageInput.value=null;
  imageDataUrl=null;
  modelStatus.textContent="Ready.";
});
"""

guide_donation = """<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donate to NGO</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header><h1>Donate to NGO</h1></header>
  <main>
    <section class="card">
      <h2>Thanks for choosing to donate</h2>
      <ol>
        <li>Backup and erase personal data.</li>
        <li>Contact a local NGO that accepts e‑waste.</li>
        <li>Schedule a pickup or drop‑off.</li>
        <li>Keep a receipt or confirmation.</li>
      </ol>
      <p class="note">Donations help communities and keep e‑waste out of landfills.</p>
      <a class="button" href="index.html">← Back to Home</a>
    </section>
  </main>
  <footer><p>© 2025 E‑Waste App</p></footer>
</body>
</html>
"""

guide_recycle = """<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recycle for Money</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header><h1>Recycle with Company</h1></header>
  <main>
    <section class="card">
      <h2>Recycle for cash with an authorized recycler</h2>
      <ol>
        <li>Remove SIM and memory cards and reset the device if possible.</li>
        <li>Contact an authorized e‑waste recycler and request a pickup.</li>
        <li>Share device details and get an estimate.</li>
        <li>Handover the device and receive payment or receipt.</li>
      </ol>
      <p class="note">Authorized recyclers process e‑waste safely and legally.</p>
      <a class="button" href="index.html">← Back to Home</a>
    </section>
  </main>
  <footer><p>© 2025 E‑Waste App</p></footer>
</body>
</html>
"""

readme_md = """# E‑Waste Recycling App (GitHub Pages)

Static, client‑only version that runs fully in the browser using TensorFlow.js (MobileNet) for on‑device image classification.

## Quick start
1. Download these files and push to a GitHub repo.
2. In GitHub: Settings → Pages → Build and deployment → Source: **Deploy from a branch**. Branch: **main**. Folder: **/** (root).
3. Wait for deploy, then open: `https://<your-username>.github.io/<repo-name>/`

## Local preview
Just open `index.html` in a modern browser (HTTPS recommended for geolocation prompts).
"""

files = {
    "index.html": index_html,
    "style.css": style_css,
    "script.js": script_js,
    "guide_donation.html": guide_donation,
    "guide_recycle.html": guide_recycle,
    "README.md": readme_md,
}

for name, content in files.items():
    with open(os.path.join(base, name), "w", encoding="utf-8") as f:
        f.write(content)

zip_path = "/mnt/data/e-waste-gh-pages.zip"
shutil.make_archive("/mnt/data/e-waste-gh-pages", "zip", base)
zip_path
