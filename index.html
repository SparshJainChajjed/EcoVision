<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>E-Waste Device Estimator & Recycle</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0b0f14;--card:#121821;--muted:#8aa0b6;--text:#e8f1ff;--accent:#58d68d;--accent2:#20b2aa}
body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b0f14,#0c1117 40%,#0b0f14);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
header{padding:18px 16px;background:rgba(9,13,19,.6);backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid rgba(255,255,255,.06)}
main{width:min(1040px,92%);margin:24px auto 42px;display:grid;gap:18px}
.card{background:#121821;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
h1{font-size:20px}
h2{font-size:22px;margin-bottom:8px}
.note{color:var(--muted);font-size:14px;margin-top:8px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
input[type=file],input[type=text],select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:#0e141b;color:var(--text)}
.button{display:inline-block;padding:12px 16px;border-radius:12px;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#0b0f14;font-weight:700;border:none;cursor:pointer;text-decoration:none}
.button.ghost{background:transparent;border:1px solid rgba(255,255,255,.14);color:var(--text)}
.chips{display:flex;gap:10px;flex-wrap:wrap}
.chip{padding:10px 14px;border-radius:999px;border:1px solid rgba(255,255,255,.14);cursor:pointer;background:#0e141b}
.chip.active{border-color:transparent;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#0b0f14;font-weight:700}
.preview{display:flex;gap:18px;align-items:flex-start;margin-top:12px}
#img{max-width:320px;max-height:240px;border-radius:12px;border:1px solid rgba(255,255,255,.08);display:none}
#preds{flex:1;display:none}
#preds table{width:100%;border-collapse:collapse;margin-top:6px}
#preds th,#preds td{border-bottom:1px solid rgba(255,255,255,.07);padding:8px;text-align:left}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.result,.recycle,.options,.guide,.details{display:none}
.value{font-weight:700}
.directory{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.dir-card{border:1px solid rgba(255,255,255,.12);border-radius:14px;padding:14px;background:#0e141b}
.dir-card h4{margin-bottom:6px}
.dir-card a{color:var(--text);text-decoration:underline;word-break:break-all}
footer{margin-top:auto;padding:16px;color:var(--muted);text-align:center;border-top:1px solid rgba(255,255,255,.06)}
@media (max-width:900px){.grid2{grid-template-columns:1fr}.directory{grid-template-columns:1fr}#img{max-width:100%;max-height:260px}}
</style>
</head>
<body>
<header><h1>E-Waste Device Estimator</h1></header>
<main>
  <section class="card">
    <h2>1) Choose Category (reliable) or Try Auto-Detect (beta)</h2>
    <div class="chips" id="categoryChips">
      <div class="chip" data-cat="Smartphone">Smartphone</div>
      <div class="chip" data-cat="Laptop">Laptop</div>
      <div class="chip" data-cat="Tablet">Tablet</div>
      <div class="chip" data-cat="Desktop PC">Desktop PC</div>
    </div>
    <div class="row" style="margin-top:12px">
      <input id="file" type="file" accept="image/*"/>
      <button id="tryAuto" class="button ghost">Try Auto-Detect (beta)</button>
      <span id="status" class="note">Pick a category or try auto-detect.</span>
    </div>
    <div class="preview">
      <img id="img" alt="preview"/>
      <div id="preds">
        <div class="note">Model suggestions</div>
        <table><thead><tr><th>Label</th><th>Prob</th></tr></thead><tbody id="tbody"></tbody></table>
      </div>
    </div>
  </section>

  <section class="card details" id="details">
    <h2>2) Tell us about the device</h2>
    <p class="note">Provide <b>brand & model</b> <i>or</i> at least the <b>purchase year</b>. Either one unlocks the estimate.</p>
    <div class="grid2">
      <div>
        <label class="note" for="brand">Brand</label>
        <input id="brand" list="brandList" placeholder="e.g., Samsung, Apple, Dell"/>
        <datalist id="brandList"></datalist>
      </div>
      <div>
        <label class="note" for="model">Model</label>
        <input id="model" type="text" placeholder="e.g., Galaxy S21, ThinkPad T480"/>
      </div>
      <div>
        <label class="note" for="year">Purchase year</label>
        <select id="year"><option value="">—</option></select>
      </div>
      <div style="display:flex;align-items:flex-end;gap:10px">
        <button id="estimate" class="button" disabled>Estimate value</button>
        <span id="hint" class="note">Waiting for brand+model or year…</span>
      </div>
    </div>
  </section>

  <section class="card result" id="result">
    <h2>3) Estimated Value</h2>
    <div class="grid2">
      <div>Category: <span id="outCat" class="value">—</span></div>
      <div>Brand/Model: <span id="outBM" class="value">—</span></div>
      <div>Purchase year: <span id="outYear" class="value">—</span></div>
      <div>Original value (approx.): <span id="outOrig" class="value">—</span></div>
      <div>Estimated current value: <span id="outCurr" class="value">—</span></div>
    </div>
  </section>

  <section class="card recycle" id="recycle">
    <h2>4) Recycle it?</h2>
    <div class="row">
      <button id="goRecycle" class="button">Yes, show options</button>
      <a href="#" id="skip" class="button ghost">No, maybe later</a>
    </div>
    <p id="locStatus" class="note"></p>
    <div id="manualCityWrap" class="row" style="display:none">
      <label for="city" class="note">Enter city</label>
      <input id="city" placeholder="City name"/>
      <button id="showByCity" class="button ghost">Show options</button>
    </div>
  </section>

  <section class="card options" id="options">
    <h2>Options near you</h2>
    <div class="row">
      <a href="#" id="openDonation" class="button ghost">Donate to NGO (free)</a>
      <a href="#" id="openRecycler" class="button ghost">Recycle with company (for cash)</a>
    </div>
    <div id="directory" class="directory" style="margin-top:12px"></div>
  </section>

  <section class="card guide" id="guideDonation">
    <h2>Donate to NGO</h2>
    <ol>
      <li>Backup and erase personal data.</li>
      <li>Contact a local NGO that accepts e-waste.</li>
      <li>Schedule a pickup or drop-off.</li>
      <li>Keep a receipt or confirmation.</li>
    </ol>
    <a class="button" href="#" id="backFromDonation">← Back</a>
  </section>

  <section class="card guide" id="guideRecycler">
    <h2>Recycle for Money</h2>
    <ol>
      <li>Remove SIM/memory cards and reset the device if possible.</li>
      <li>Contact an authorized recycler and request a pickup.</li>
      <li>Share device details and get an estimate.</li>
      <li>Handover the device and receive payment or receipt.</li>
    </ol>
    <a class="button" href="#" id="backFromRecycler">← Back</a>
  </section>
</main>
<footer>© 2025 E-Waste App</footer>

<script>
/* ---------- State & helpers ---------- */
let selectedCategory=null, dataUrl=null, net=null;
const nowYear=new Date().getFullYear();
const brandSuggestions={
  "Smartphone":["Apple","Samsung","OnePlus","Xiaomi","Realme","Vivo","Oppo","Motorola","Nokia","Google"],
  "Laptop":["Apple","Dell","HP","Lenovo","ASUS","Acer","MSI"],
  "Tablet":["Apple","Samsung","Lenovo","Xiaomi","Amazon"],
  "Desktop PC":["Dell","HP","Lenovo","Acer","ASUS","DIY/Custom"]
};
const baseOriginal={Smartphone:50000,Laptop:70000,Tablet:30000,"Desktop PC":40000};
const brandMultiplier=(cat,brand)=>{
  const b=(brand||"").toLowerCase();
  if(cat==="Smartphone"){
    if(["apple"].some(k=>b.includes(k))) return 1.5;
    if(["samsung","oneplus","google"].some(k=>b.includes(k))) return 1.2;
    if(["xiaomi","realme","vivo","oppo","motorola","nokia"].some(k=>b.includes(k))) return 0.9;
  }
  if(cat==="Laptop"){
    if(["apple"].some(k=>b.includes(k))) return 1.4;
    if(["dell","hp","lenovo"].some(k=>b.includes(k))) return 1.1;
    if(["asus","acer","msi"].some(k=>b.includes(k))) return 1.0;
  }
  if(cat==="Tablet"){
    if(["apple"].some(k=>b.includes(k))) return 1.4;
    if(["samsung","lenovo","xiaomi"].some(k=>b.includes(k))) return 1.0;
  }
  if(cat==="Desktop PC"){
    if(["dell","hp","lenovo"].some(k=>b.includes(k))) return 1.0;
    if(["diy","custom"].some(k=>b.includes(k))) return 1.1;
  }
  return 1.0;
};
const tierMultiplier=model=>{
  const m=(model||"").toLowerCase();
  if(/(ultra|max|pro\s?max|pro\+|i7|i9|ryzen 7|ryzen 9|rtx|macbook pro|thinkpad t|xps|rog|predator)/.test(m)) return 1.35;
  if(/(pro|plus|note|s2\d|a7\d|i5|ryzen 5|macbook air|thinkpad|ideapad)/.test(m)) return 1.15;
  return 1.0;
};
const deprec={
  Smartphone:{d1:0.35,ds:0.25,floor:0.10},
  Laptop:{d1:0.30,ds:0.20,floor:0.20},
  Tablet:{d1:0.30,ds:0.22,floor:0.12},
  "Desktop PC":{d1:0.25,ds:0.15,floor:0.25}
};
const round500=n=>Math.max(0,Math.round(n/500)*500);
const INR=new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0});
function mapLabelToCategory(s){
  const l=(s||"").toLowerCase();
  if(l.includes("laptop")||l.includes("notebook")) return "Laptop";
  if(l.includes("smartphone")||l.includes("mobile")||l.includes("cellular")||l.includes("telephone")||l.includes("ipod")) return "Smartphone";
  if(l.includes("tablet")||l.includes("ipad")) return "Tablet";
  if(l.includes("monitor")||l.includes("screen")||l.includes("desktop")) return "Desktop PC";
  return null;
}

/* ---------- DOM ---------- */
const chips=document.getElementById("categoryChips");
const statusEl=document.getElementById("status");
const fileEl=document.getElementById("file");
const imgEl=document.getElementById("img");
const tryAutoBtn=document.getElementById("tryAuto");
const predsWrap=document.getElementById("preds");
const tbody=document.getElementById("tbody");

const details=document.getElementById("details");
const brandEl=document.getElementById("brand");
const brandList=document.getElementById("brandList");
const modelEl=document.getElementById("model");
const yearEl=document.getElementById("year");
const estimateBtn=document.getElementById("estimate");
const hint=document.getElementById("hint");

const result=document.getElementById("result");
const outCat=document.getElementById("outCat");
const outBM=document.getElementById("outBM");
const outYear=document.getElementById("outYear");
const outOrig=document.getElementById("outOrig");
const outCurr=document.getElementById("outCurr");

const recycle=document.getElementById("recycle");
const goRecycle=document.getElementById("goRecycle");
const skip=document.getElementById("skip");
const locStatus=document.getElementById("locStatus");
const manualCityWrap=document.getElementById("manualCityWrap");
const cityEl=document.getElementById("city");
const showByCity=document.getElementById("showByCity");

const options=document.getElementById("options");
const directoryEl=document.getElementById("directory");
const openDonation=document.getElementById("openDonation");
const openRecycler=document.getElementById("openRecycler");
const guideDonation=document.getElementById("guideDonation");
const guideRecycler=document.getElementById("guideRecycler");
const backFromDonation=document.getElementById("backFromDonation");
const backFromRecycler=document.getElementById("backFromRecycler");

/* ---------- Init ---------- */
for(let y=nowYear;y>=2005;y--){const o=document.createElement("option");o.value=String(y);o.textContent=String(y);yearEl.appendChild(o)}

/* ---------- Category selection ---------- */
chips.addEventListener("click",e=>{
  const el=e.target.closest(".chip"); if(!el) return;
  [...chips.children].forEach(c=>c.classList.remove("active"));
  el.classList.add("active");
  selectedCategory=el.dataset.cat;
  statusEl.textContent="Selected: "+selectedCategory;
  setupBrandList(selectedCategory);
  details.style.display="block";
  validateDetails();
});

/* ---------- Image handling ---------- */
fileEl.addEventListener("change",()=>{
  const f=fileEl.files[0];
  if(!f){imgEl.style.display="none";dataUrl=null;return}
  const r=new FileReader();
  r.onload=e=>{dataUrl=e.target.result;imgEl.src=dataUrl;imgEl.style.display="block"};
  r.readAsDataURL(f);
});

/* ---------- Auto-Detect (lazy-load TFJS only when clicked) ---------- */
async function loadScript(src){return new Promise((res,rej)=>{const s=document.createElement("script");s.src=src;s.onload=res;s.onerror=()=>rej(new Error("Failed: "+src));document.head.appendChild(s)})}
async function ensureModel(){
  if(net) return true;
  try{
    await loadScript("https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js");
    await loadScript("https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@2.1.0");
    if(window.tf && tf.ready) await tf.ready();
    try{ if(tf && tf.setBackend) await tf.setBackend("webgl"); }catch(e){}
    net=await mobilenet.load();
    return true;
  }catch(e){ statusEl.textContent="Model failed to load. Pick category manually."; return false; }
}
tryAutoBtn.addEventListener("click",async()=>{
  if(!dataUrl){statusEl.textContent="Choose an image first.";return}
  statusEl.textContent="Loading model…";
  const ok=await ensureModel(); if(!ok) return;
  statusEl.textContent="Identifying…";
  try{
    const preds=await net.classify(imgEl);
    tbody.innerHTML=""; predsWrap.style.display="block";
    preds.slice(0,3).forEach(p=>{
      const tr=document.createElement("tr");
      const td1=document.createElement("td"); td1.textContent=p.className;
      const td2=document.createElement("td"); td2.textContent=(p.probability*100).toFixed(1)+"%";
      tr.appendChild(td1); tr.appendChild(td2); tbody.appendChild(tr);
    });
    const top=preds[0]?.className||"";
    const mapped=mapLabelToCategory(top) || "Smartphone";
    // highlight chip and proceed
    [...chips.children].forEach(c=>{c.classList.toggle("active", c.dataset.cat===mapped)});
    selectedCategory=mapped;
    setupBrandList(mapped);
    details.style.display="block";
    validateDetails();
    statusEl.textContent="Suggestion: "+mapped+" (confirm or change)";
  }catch(e){
    statusEl.textContent="Identification failed. Pick category manually.";
  }
});

/* ---------- Details gating ---------- */
function setupBrandList(cat){
  brandList.innerHTML="";
  (brandSuggestions[cat]||[]).forEach(b=>{
    const o=document.createElement("option");o.value=b;brandList.appendChild(o);
  });
}
function validateDetails(){
  const hasBM = brandEl.value.trim() && modelEl.value.trim();
  const hasYear = !!yearEl.value;
  estimateBtn.disabled = !(hasBM || hasYear) || !selectedCategory;
  hint.textContent = estimateBtn.disabled ? "Enter brand & model, or choose a year." : "Looks good — estimate ready.";
}
brandEl.addEventListener("input",validateDetails);
modelEl.addEventListener("input",validateDetails);
yearEl.addEventListener("change",validateDetails);

/* ---------- Estimation ---------- */
estimateBtn.addEventListener("click",()=>{
  if(!selectedCategory) return;
  const brand=brandEl.value.trim();
  const model=modelEl.value.trim();
  const year=yearEl.value ? parseInt(yearEl.value,10) : null;

  const base = baseOriginal[selectedCategory] || 40000;
  const multBrand = brandMultiplier(selectedCategory, brand);
  const multTier = tierMultiplier(model);
  const origApprox = base * multBrand * multTier;

  let curr = origApprox * 0.8;
  if(year){
    const age=Math.max(0, nowYear - year);
    const p=deprec[selectedCategory] || {d1:0.3, ds:0.2, floor:0.15};
    let factor;
    if(age===0){ factor=0.80; }
    else { factor=(1-p.d1)*Math.pow(1-p.ds, Math.max(0,age-1)); factor=Math.max(p.floor,factor); }
    curr = origApprox * factor;
  }
  const outBrandModel = (brand||model) ? [brand,model].filter(Boolean).join(" ") : "—";

  outCat.textContent = selectedCategory;
  outBM.textContent = outBrandModel;
  outYear.textContent = year ? year : "—";
  outOrig.textContent = INR.format(Math.round(origApprox));
  outCurr.textContent = INR.format(round500(curr));

  result.style.display="block";
  recycle.style.display="block";
  window.scrollTo({top:result.offsetTop-12, behavior:"smooth"});
});

/* ---------- Recycle flow & directory ---------- */
const directoryData={
  bengaluru:{
    ngos:[
      {name:"Saahas Zero Waste",site:"https://saahaszerowaste.com/",phone:"+91-80-4168-9889"},
      {name:"Share At Door Step (pickup)",site:"https://shareatdoorstep.com/donate/computer-e-waste/",phone:""},
      {name:"BBMP E-Waste Collection (info)",site:"https://bbmp.gov.in/",phone:""}
    ],
    recyclers:[
      {name:"Zolopik Recycling",site:"https://zolopik.com/",phone:"+91-8884449985"},
      {name:"E-Parisaraa Pvt. Ltd.",site:"https://www.eparisaraa.com/",phone:"+91-80-2836-7770"},
      {name:"Namo E-Waste (serviceable)",site:"https://www.namoe-waste.com/",phone:"1800-123-445555"}
    ]
  },
  default:{
    ngos:[
      {name:"Share At Door Step (pickup)",site:"https://shareatdoorstep.com/donate/computer-e-waste/",phone:""},
      {name:"Local Municipal E-Waste Info",site:"https://www.india.gov.in/topics/environment-forests/e-waste",phone:""},
      {name:"Karo Sambhav Collection Finder",site:"https://www.karosambhav.com/",phone:""}
    ],
    recyclers:[
      {name:"Zolopik Recycling",site:"https://zolopik.com/",phone:"+91-8884449985"},
      {name:"Recycler Directory (CPCB)",site:"https://cpcb.nic.in/e-waste/",phone:""},
      {name:"Producer Responsibility Orgs",site:"https://moefcc.gov.in/",phone:""}
    ]
  }
};
function inBengaluru(lat,lon){return lat>=12.80&&lat<=13.20&&lon>=77.40&&lon<=77.80}
function keyFromCity(text){const s=(text||"").toLowerCase();return (s.includes("bengaluru")||s.includes("bangalore"))?"bengaluru":"default"}
function renderDirectory(key){
  const data=directoryData[key]||directoryData.default;
  const cards=[];
  data.ngos.forEach(x=>{cards.push(`<div class="dir-card"><h4>NGO</h4><p>${x.name}</p><a href="${x.site}" target="_blank">${x.site}</a>${x.phone?`<p>${x.phone}</p>`:""}</div>`)});
  data.recyclers.forEach(x=>{cards.push(`<div class="dir-card"><h4>Recycler</h4><p>${x.name}</p><a href="${x.site}" target="_blank">${x.site}</a>${x.phone?`<p>${x.phone}</p>`:""}</div>`)});
  directoryEl.innerHTML=cards.join("");
  options.style.display="block";
  window.scrollTo({top:options.offsetTop-12, behavior:"smooth"});
}
goRecycle.addEventListener("click",()=>{
  if("geolocation" in navigator){
    locStatus.textContent="Detecting your location…";
    navigator.geolocation.getCurrentPosition(
      pos=>{const {latitude,longitude}=pos.coords;locStatus.textContent=`Location detected (${latitude.toFixed(2)}, ${longitude.toFixed(2)}).`;renderDirectory(inBengaluru(latitude,longitude)?"bengaluru":"default")},
      err=>{locStatus.textContent="Unable to get location. Enter city below.";manualCityWrap.style.display="flex";}
    );
  }else{
    locStatus.textContent="Geolocation not supported. Enter city below.";
    manualCityWrap.style.display="flex";
  }
});
showByCity.addEventListener("click",()=>renderDirectory(keyFromCity(cityEl.value)));

/* ---------- Guides & resets ---------- */
openDonation.addEventListener("click",e=>{e.preventDefault();guideRecycler.style.display="none";guideDonation.style.display="block";window.scrollTo({top:guideDonation.offsetTop-12,behavior:"smooth"});});
openRecycler.addEventListener("click",e=>{e.preventDefault();guideDonation.style.display="none";guideRecycler.style.display="block";window.scrollTo({top:guideRecycler.offsetTop-12,behavior:"smooth"});});
backFromDonation.addEventListener("click",e=>{e.preventDefault();guideDonation.style.display="none"}); 
backFromRecycler.addEventListener("click",e=>{e.preventDefault();guideRecycler.style.display="none"});
skip.addEventListener("click",e=>{
  e.preventDefault();
  [result,recycle,options,guideDonation,guideRecycler].forEach(el=>el.style.display="none");
  directoryEl.innerHTML=""; locStatus.textContent=""; manualCityWrap.style.display="none";
  window.scrollTo({top:0,behavior:"smooth"});
});
</script>
</body>
</html>
