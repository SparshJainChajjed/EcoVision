<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>EcoVision ‚Äî Prototype</title>
<meta name="description" content="Click-through prototype: upload phone photos, assess damage, enter details, get estimate, choose recycle or giveaway, view suggested ask price." />
<style>
  :root{
    --bg:#0a0b0f;--card:#11131a;--text:#e9ecf1;--muted:#cfd6e4;
    --accent:#1f8cff;--accent2:#62ff9e;--line:rgba(255,255,255,.08);
    --ok:#2fd26a;--warn:#ffdf7f;--bad:#ff5d5d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji"}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:920px;margin:0 auto;padding:16px 16px 88px}

  /* Header */
  header.app{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;
    padding:14px 16px;background:rgba(10,11,15,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:42px;height:42px;border-radius:14px;display:grid;place-items:center;
    background:conic-gradient(from 180deg at 50% 50%, #27e6f5, #62ff9e, #27e6f5);color:#0a0b0f;
    font-weight:800;font-size:20px;animation:spin 6s linear infinite}
  @keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
  .brand h1{margin:0;font-size:18px;font-weight:800}
  .tag{margin:2px 0 0;font-size:12px;color:#92a0b8}
  .btn{display:inline-block;padding:11px 14px;border-radius:12px;font-weight:700;background:var(--accent);color:#fff;border:1px solid var(--accent);cursor:pointer}
  .btn.ghost{background:#0d1117;border-color:var(--line);color:#fff}
  .btn.alt{background:var(--accent2);color:#0a0b0f;border-color:transparent}
  .btn.block{display:block;width:100%;text-align:center}
  .btn[disabled]{opacity:.5;cursor:not-allowed}

  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;margin:12px 0;
    box-shadow:0 10px 30px rgba(0,0,0,.2)}
  h2{font-size:22px;margin:0 0 8px}
  h3{font-size:18px;margin:0 0 10px}
  p{color:var(--muted);line-height:1.55;margin:0 0 10px}
  label{font-size:13px;color:#b9c7db}
  input,select{width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);background:#0d1117;color:#e9ecf1;margin-top:6px}
  .row{display:flex;gap:10px}
  .col{flex:1}
  .grid{display:grid;gap:10px}
  @media(min-width:720px){.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}}

  .progress{height:6px;border-radius:999px;background:#0d1117;border:1px solid var(--line);overflow:hidden;margin:10px 0 6px}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .2s}

  /* Step container */
  .step{display:none}
  .step.active{display:block;animation:in .25s ease}
  @keyframes in{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

  /* Upload previews */
  .preview{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  .ph{width:120px;height:170px;border-radius:12px;border:1px solid var(--line);background:#06101a;display:grid;place-items:center;overflow:hidden}
  .ph img{max-width:100%;max-height:100%;display:block}

  /* Damage chips + slider */
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--line);background:#0f141c;font-size:12px;cursor:pointer}
  .chip.sel{outline:2px solid var(--accent)}
  .slider{appearance:none;width:100%;height:10px;border-radius:999px;background:#0d1117;border:1px solid var(--line)}
  .slider::-webkit-slider-thumb{appearance:none;width:22px;height:22px;border-radius:50%;background:var(--accent2);border:2px solid #062}
  .hint{font-size:12px;color:#98a9c0}

  /* Switches */
  .toggle{display:flex;justify-content:space-between;align-items:center;background:#0d1117;border:1px solid var(--line);border-radius:12px;padding:10px}
  .switch{position:relative;width:48px;height:26px;background:#2a3446;border-radius:999px}
  .knob{position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#c7d6ee;transition:left .25s}
  .on .switch{background:var(--ok)} .on .knob{left:25px}

  /* Gauge + breakdown */
  .gauge{width:200px;max-width:70vw;aspect-ratio:1;border-radius:50%;display:grid;place-items:center;position:relative;margin:10px auto;background:conic-gradient(var(--accent2) var(--pct,40%), #243042 0)}
  .gauge::after{content:"";position:absolute;inset:12%;background:#0b0f16;border-radius:50%}
  .price{position:absolute;font-weight:900;font-size:22px}
  .table{width:100%;border-collapse:collapse;margin-top:10px;font-size:13px}
  .table td{padding:8px;border-bottom:1px solid var(--line);color:#cfe7ff}
  .table td:nth-child(2){text-align:right}

  /* Cards for partners */
  .partners{display:grid;gap:10px;margin-top:8px}
  .p{display:flex;justify-content:space-between;align-items:center;background:#0d1117;border:1px solid var(--line);border-radius:12px;padding:10px}
  .pill{padding:6px 10px;border-radius:999px;border:1px solid var(--line);background:#0f141c;font-size:12px;white-space:nowrap}

  /* Nav */
  .nav{display:flex;gap:10px;margin-top:10px}
  .nav .btn{flex:1}
  .toplink{font-size:12px;color:#9eb5d1}
</style>
</head>
<body>

<header class="app">
  <div class="brand">
    <div class="logo">üåø</div>
    <div>
      <h1>EcoVision</h1>
      <div class="tag">Try the prototype</div>
    </div>
  </div>
  <a class="btn ghost" href="index.html">‚Üê Home</a>
</header>

<main class="wrap">

  <div class="card">
    <div class="progress"><div class="bar" id="bar"></div></div>
    <div class="toplink" id="stepTitle">Step 1 of 8 ¬∑ Upload photos</div>
  </div>

  <!-- STEP 1: Upload -->
  <section class="card step active" data-step="1">
    <h2>Upload phone photos</h2>
    <p>For best results, add <b>front and back</b> photos with good lighting. (This prototype shows a preview only.)</p>

    <div class="grid2">
      <div>
        <label>Front photo
          <input type="file" accept="image/*" id="frontInput" />
        </label>
        <div class="ph preview"><img id="frontPreview" alt="Front preview (optional)" /></div>
      </div>
      <div>
        <label>Back photo
          <input type="file" accept="image/*" id="backInput" />
        </label>
        <div class="ph preview"><img id="backPreview" alt="Back preview (optional)" /></div>
      </div>
    </div>

    <div class="nav">
      <button class="btn ghost" disabled>Back</button>
      <button class="btn" id="to2">Next</button>
    </div>
  </section>

  <!-- STEP 2: Damage -->
  <section class="card step" data-step="2">
    <h2>Damage & severity</h2>
    <p>Select what we should consider. (In the real app, we‚Äôd detect cracks/dents automatically from your photos.)</p>

    <div class="chips" id="damageChips">
      <span class="chip" data-key="cracked_screen">Cracked screen</span>
      <span class="chip" data-key="back_glass">Back glass crack</span>
      <span class="chip" data-key="dents">Dents/Frame scuffs</span>
      <span class="chip" data-key="water">Water damage</span>
      <span class="chip" data-key="no_issues">Looks fine</span>
    </div>

    <div style="margin-top:12px">
      <label>Overall damage severity: <span id="sevLabel">20%</span></label>
      <input class="slider" id="sev" type="range" min="0" max="100" value="20" />
      <div class="hint">Move the slider to simulate how severe the damage is.</div>
    </div>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <button class="btn" id="to3">Next</button>
    </div>
  </section>

  <!-- STEP 3: Model & date -->
  <section class="card step" data-step="3">
    <h2>Model & purchase date</h2>
    <div class="grid2">
      <div>
        <label>Model
          <select id="model">
            <option value="iph8">iPhone 8</option>
            <option value="iphX">iPhone X</option>
            <option value="iphXR">iPhone XR</option>
            <option value="iph11" selected>iPhone 11</option>
            <option value="iph12">iPhone 12</option>
            <option value="iph12p">iPhone 12 Pro</option>
            <option value="iph13">iPhone 13</option>
            <option value="iph13p">iPhone 13 Pro</option>
            <option value="iph14">iPhone 14</option>
            <option value="iph14p">iPhone 14 Pro</option>
          </select>
        </label>
      </div>
      <div class="row">
        <div class="col">
          <label>Purchase month
            <select id="month"></select>
          </label>
        </div>
        <div class="col">
          <label>Year
            <select id="year"></select>
          </label>
        </div>
      </div>
    </div>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <button class="btn" id="to4">Next</button>
    </div>
  </section>

  <!-- STEP 4: Internals -->
  <section class="card step" data-step="4">
    <h2>Internals working?</h2>
    <div class="grid">
      <div class="toggle on" data-key="camera"><div>Camera</div><div class="switch"><div class="knob"></div></div></div>
      <div class="toggle on" data-key="speaker"><div>Speaker</div><div class="switch"><div class="knob"></div></div></div>
      <div class="toggle on" data-key="charging"><div>Charging</div><div class="switch"><div class="knob"></div></div></div>
      <div class="toggle on" data-key="buttons"><div>Buttons</div><div class="switch"><div class="knob"></div></div></div>
      <div class="toggle" data-key="motherboard"><div>Motherboard</div><div class="switch"><div class="knob"></div></div></div>
    </div>

    <div style="margin-top:12px">
      <label>Battery health % (estimate)</label>
      <input class="slider" id="battery" type="range" min="60" max="100" value="88" />
      <div class="hint">If you know your battery health from settings, adjust here.</div>
    </div>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <button class="btn" id="to5">Get Estimate</button>
    </div>
  </section>

  <!-- STEP 5: Estimate -->
  <section class="card step" data-step="5">
    <h2>Your estimate</h2>
    <div class="gauge" id="gauge" style="--pct:60%">
      <div class="price" id="price">‚Çπ‚Äî</div>
    </div>

    <table class="table" aria-label="Price breakdown">
      <tr><td>Base price (model)</td><td id="pBase">‚Çπ‚Äî</td></tr>
      <tr><td>Age depreciation</td><td id="pAge">‚Äî%</td></tr>
      <tr><td>Damage severity</td><td id="pDamage">‚Äî%</td></tr>
      <tr><td>Internals issues</td><td id="pInternal">‚Äî%</td></tr>
      <tr><td>Battery adjustment</td><td id="pBattery">‚Äî%</td></tr>
      <tr><td><b>Estimated value</b></td><td id="pEst"><b>‚Çπ‚Äî</b></td></tr>
    </table>

    <p class="hint">This is a damage-aware estimate based on your inputs. Dealers may quote differently.</p>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <button class="btn" id="to6">Continue</button>
    </div>
  </section>

  <!-- STEP 6: Location -->
  <section class="card step" data-step="6">
    <h2>Share location</h2>
    <p>We use your location to surface nearby partners or donation centers. You can also skip.</p>
    <div class="row">
      <button class="btn alt" id="locYes">Use my location</button>
      <button class="btn ghost" id="locSkip">Skip</button>
    </div>
    <div id="locOut" class="hint" style="margin-top:8px"></div>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <button class="btn" id="to7">Next</button>
    </div>
  </section>

  <!-- STEP 7: Choose option -->
  <section class="card step" data-step="7">
    <h2>What do you want to do?</h2>
    <div class="partners">
      <div class="p">
        <div>
          <b>üí∏ Get Money</b>
          <div class="hint">We‚Äôll connect you to suitable partners based on your phone‚Äôs condition.</div>
        </div>
        <button class="btn" id="chooseMoney">Select</button>
      </div>
      <div class="p">
        <div>
          <b>ü§ù Give it Away</b>
          <div class="hint">We‚Äôll suggest trusted NGOs/centers near you.</div>
        </div>
        <button class="btn ghost" id="chooseGive">Select</button>
      </div>
    </div>

    <div id="partnerList" style="display:none;margin-top:10px">
      <h3>Suggested partners</h3>
      <div class="partners" id="partners"></div>
    </div>

    <div id="giveList" style="display:none;margin-top:10px">
      <h3>Places to give away</h3>
      <div class="partners" id="givers"></div>
    </div>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <button class="btn" id="to8">Next</button>
    </div>
  </section>

  <!-- STEP 8: Suggested ask & summary -->
  <section class="card step" data-step="8">
    <h2>Suggested ask & summary</h2>
    <p><b>Suggested ask (self-listing):</b> <span id="ask">‚Çπ‚Äî</span></p>
    <p class="hint"><b>‚ö†Ô∏è Honesty reminder:</b> This price reflects your inputs. It‚Äôs not a dealer quote and may change after inspection.</p>

    <div class="card" style="margin-top:10px">
      <h3>Summary</h3>
      <p id="summary"></p>
    </div>

    <div class="nav">
      <button class="btn ghost" data-back>Back</button>
      <a class="btn block" href="index.html">Finish</a>
    </div>
  </section>
</main>

<nav class="tabbar" style="position:fixed;left:0;right:0;bottom:0;background:#0d1117;border-top:1px solid var(--line);display:flex">
  <a class="tab" style="flex:1;display:grid;place-items:center;padding:12px 0;color:#fff;border-top:2px solid var(--accent)" href="index.html">Overview</a>
  <a class="tab" style="flex:1;display:grid;place-items:center;padding:12px 0;color:#a7b3c6" href="page2.html">Start</a>
</nav>

<script>
/* ===== Helpers & State ===== */
const S = {
  step: 1,
  photos: { front:null, back:null },
  damage: { cracked_screen:false, back_glass:false, dents:false, water:false, no_issues:false, severity:20 },
  model: 'iph11',
  month: null,
  year: null,
  internals: { camera:true, speaker:true, charging:true, buttons:true, motherboard:false, battery:88 },
  estimate: 0,
  ask: 0,
  location: null,
  choice: null, // 'money' | 'give'
};

const modelBase = {
  iph8: 9000, iphX: 15000, iphXR:13000,
  iph11:22000, iph12:30000, iph12p:38000,
  iph13:42000, iph13p:52000, iph14:60000, iph14p:75000
};

const stepCount = 8;

/* ===== UI Elements ===== */
const steps = [...document.querySelectorAll('.step')];
const bar = document.getElementById('bar');
const title = document.getElementById('stepTitle');

/* Progress + step switching */
function setStep(n){
  S.step = n;
  steps.forEach(sec => sec.classList.toggle('active', parseInt(sec.dataset.step,10)===n));
  bar.style.width = (n/stepCount*100) + '%';
  const titles = [
    '', 'Step 1 of 8 ¬∑ Upload photos', 'Step 2 of 8 ¬∑ Damage & severity',
    'Step 3 of 8 ¬∑ Model & date', 'Step 4 of 8 ¬∑ Internals',
    'Step 5 of 8 ¬∑ Estimate', 'Step 6 of 8 ¬∑ Location',
    'Step 7 of 8 ¬∑ Choose option', 'Step 8 of 8 ¬∑ Suggested ask & summary'
  ];
  title.textContent = titles[n] || '';
}

/* ===== Step 1: Upload previews ===== */
function wirePreview(inputEl, imgEl, key){
  inputEl.addEventListener('change', ()=>{
    const f = inputEl.files && inputEl.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = e => {
      imgEl.src = e.target.result;
      S.photos[key] = true;
    };
    reader.readAsDataURL(f);
  });
}
wirePreview(document.getElementById('frontInput'), document.getElementById('frontPreview'), 'front');
wirePreview(document.getElementById('backInput'), document.getElementById('backPreview'), 'back');

document.getElementById('to2').addEventListener('click', ()=> setStep(2));

/* ===== Step 2: Damage & severity ===== */
const sev = document.getElementById('sev');
const sevLabel = document.getElementById('sevLabel');
sev.addEventListener('input', ()=>{ S.damage.severity = parseInt(sev.value,10); sevLabel.textContent = S.damage.severity + '%'; });

const chips = document.getElementById('damageChips');
chips.addEventListener('click', (e)=>{
  const el = e.target.closest('.chip'); if(!el) return;
  const key = el.dataset.key;
  if(key==='no_issues'){
    // selecting "looks fine" clears other damage flags
    S.damage = { cracked_screen:false, back_glass:false, dents:false, water:false, no_issues:true, severity:0 };
    sev.value = 0; sevLabel.textContent = '0%';
    chips.querySelectorAll('.chip').forEach(c=>c.classList.remove('sel'));
    el.classList.add('sel');
    return;
  }
  S.damage.no_issues = false;
  el.classList.toggle('sel');
  S.damage[key] = el.classList.contains('sel');
});

document.querySelectorAll('[data-back]').forEach(b=> b.addEventListener('click', ()=> setStep(S.step-1)));
document.getElementById('to3').addEventListener('click', ()=> setStep(3));

/* ===== Step 3: Model & date ===== */
const modelEl = document.getElementById('model');
modelEl.value = S.model;
modelEl.addEventListener('change', ()=> S.model = modelEl.value);

// Populate months/years
const monthEl = document.getElementById('month');
const yearEl = document.getElementById('year');
const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
months.forEach((m,i)=> {
  const o=document.createElement('option'); o.value=i+1; o.textContent=m; monthEl.appendChild(o);
});
const yNow = new Date().getFullYear();
for(let y=yNow; y>=2015; y--){
  const o=document.createElement('option'); o.value=y; o.textContent=y; yearEl.appendChild(o);
}
monthEl.value = (new Date().getMonth()+1);
yearEl.value = yNow-3;
S.month = parseInt(monthEl.value,10);
S.year = parseInt(yearEl.value,10);
monthEl.addEventListener('change', ()=> S.month=parseInt(monthEl.value,10));
yearEl.addEventListener('change', ()=> S.year=parseInt(yearEl.value,10));

document.getElementById('to4').addEventListener('click', ()=> setStep(4));

/* ===== Step 4: Internals ===== */
document.querySelectorAll('.toggle').forEach(t=>{
  t.addEventListener('click', ()=>{
    t.classList.toggle('on');
    S.internals[t.dataset.key] = t.classList.contains('on');
  });
});
const batt = document.getElementById('battery');
batt.addEventListener('input', ()=> S.internals.battery = parseInt(batt.value,10));

document.getElementById('to5').addEventListener('click', ()=>{
  calculateEstimate();
  setStep(5);
});

/* ===== Step 5: Estimate ===== */
function monthsSince(year, month){
  const now = new Date();
  const y = now.getFullYear() - year;
  const m = (now.getMonth()+1) - month;
  return Math.max(0, y*12 + m);
}

function calculateEstimate(){
  // Base
  const base = modelBase[S.model] || 15000;

  // Age depreciation: ~2% per month, cap 90%
  const ageM = monthsSince(S.year, S.month);
  const agePct = Math.min(90, Math.max(0, ageM * 2));

  // Damage severity: take slider; water damage adds flat 25%
  const dmgPct = Math.min(95, S.damage.severity * 0.5 + (S.damage.water ? 25 : 0));

  // Internals: each broken (off) = -10%
  const issues = ['camera','speaker','charging','buttons','motherboard'].filter(k=> !S.internals[k]).length;
  const internalPct = issues * 10;

  // Battery health: <=80 => -10%, <=90 => -5%
  let battPct = 0;
  if(S.internals.battery <= 80) battPct = 10;
  else if(S.internals.battery <= 90) battPct = 5;

  // Apply reductions cumulatively on base
  let price = base;
  price *= (1 - agePct/100);
  price *= (1 - dmgPct/100);
  price *= (1 - internalPct/100);
  price *= (1 - battPct/100);
  price = Math.max(500, Math.round(price/100)*100); // clamp & round

  S.estimate = price;
  S.ask = Math.round(price * 1.05 / 100) * 100;

  // Update UI
  document.getElementById('pBase').textContent = '‚Çπ' + base.toLocaleString('en-IN');
  document.getElementById('pAge').textContent = '-' + agePct + '%';
  document.getElementById('pDamage').textContent = '-' + Math.round(dmgPct) + '%';
  document.getElementById('pInternal').textContent = '-' + internalPct + '%';
  document.getElementById('pBattery').textContent = '-' + battPct + '%';

  document.getElementById('pEst').innerHTML = '<b>‚Çπ' + price.toLocaleString('en-IN') + '</b>';
  document.getElementById('price').textContent = '‚Çπ' + price.toLocaleString('en-IN');

  const gauge = document.getElementById('gauge');
  // Map price to 0-100 vs base for the model (rough)
  const pct = Math.max(5, Math.min(98, Math.round((price / base) * 100)));
  gauge.style.setProperty('--pct', pct + '%');
}

document.getElementById('to6').addEventListener('click', ()=> setStep(6));

/* ===== Step 6: Location ===== */
const locOut = document.getElementById('locOut');
document.getElementById('locYes').addEventListener('click', ()=>{
  if(!navigator.geolocation){ locOut.textContent='Geolocation not supported. You can skip.'; return; }
  navigator.geolocation.getCurrentPosition((pos)=>{
    S.location = { lat:pos.coords.latitude, lon:pos.coords.longitude, acc:pos.coords.accuracy };
    locOut.textContent = `Location captured ~ ${S.location.lat.toFixed(4)}, ${S.location.lon.toFixed(4)} (¬±${Math.round(S.location.acc)} m)`;
  }, (err)=>{
    locOut.textContent = 'Permission denied or unavailable. You can skip.';
  }, { enableHighAccuracy:true, timeout:8000, maximumAge:0 });
});
document.getElementById('locSkip').addEventListener('click', ()=>{
  S.location = null;
  locOut.textContent = 'Skipped. We‚Äôll still show generic options.';
});
document.getElementById('to7').addEventListener('click', ()=> setStep(7));

/* ===== Step 7: Choose option + lists ===== */
const partnerList = document.getElementById('partnerList');
const partners = document.getElementById('partners');
const giveList = document.getElementById('giveList');
const givers = document.getElementById('givers');

document.getElementById('chooseMoney').addEventListener('click', ()=>{
  S.choice = 'money';
  giveList.style.display = 'none';
  partnerList.style.display = 'block';
  // Suggest partners based on condition (rough rule)
  const cond = S.estimate > 10000 ? ['Cashify','Servify','ReGlobe'] : ['Zolopik','Karo Sambhav','Attero'];
  partners.innerHTML = cond.map(n => `
    <div class="p">
      <div><b>${n}</b><div class="hint">Tap to visit their site and compare quotes.</div></div>
      <span class="pill">Suggested</span>
    </div>`).join('');
});

document.getElementById('chooseGive').addEventListener('click', ()=>{
  S.choice = 'give';
  partnerList.style.display = 'none';
  giveList.style.display = 'block';
  const near = ['e-Waste Collection Center', 'City Recycling Hub', 'Green NGO Drop-off'];
  givers.innerHTML = near.map(n => `
    <div class="p">
      <div><b>${n}</b><div class="hint">We‚Äôll show addresses when you go live.</div></div>
      <span class="pill">Nearby</span>
    </div>`).join('');
});

document.getElementById('to8').addEventListener('click', ()=>{
  // Set ask and summary
  document.getElementById('ask').textContent = '‚Çπ' + S.ask.toLocaleString('en-IN');
  const issues = Object.entries(S.damage).filter(([k,v])=> v===true && k!=='no_issues' && k!=='severity').map(([k])=>k.replace('_',' '));
  const internalsBad = Object.entries(S.internals).filter(([k,v])=> ['camera','speaker','charging','buttons','motherboard'].includes(k) && !v).map(([k])=>k);
  const when = `${months[ (S.month||1)-1 ]} ${S.year||'‚Äî'}`;
  document.getElementById('summary').innerHTML =
    `<b>Model:</b> ${document.querySelector('#model option:checked').textContent}<br>
     <b>Purchased:</b> ${when}<br>
     <b>Damage:</b> ${issues.length? issues.join(', '): 'none'} (severity ${S.damage.severity}%)<br>
     <b>Internals not working:</b> ${internalsBad.length? internalsBad.join(', '): 'none'}<br>
     <b>Battery health:</b> ${S.internals.battery}%<br>
     <b>Estimated value:</b> ‚Çπ${S.estimate.toLocaleString('en-IN')}<br>
     <b>Choice:</b> ${S.choice=== 'money' ? 'Get Money (partners)' : S.choice==='give' ? 'Give it Away' : '‚Äî'}
    `;
  setStep(8);
});

/* ===== Back buttons (generic) ===== */
document.querySelectorAll('[data-back]').forEach(b=> b.addEventListener('click', ()=> setStep(Math.max(1, S.step-1))));

/* Init */
setStep(1);
</script>
</body>
</html>
