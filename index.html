<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>E-waste Device Identifier</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b0c10;--card:#121317;--muted:#8e93a1;--text:#e9ecf1;--accent:#6ee7ff;--ok:#2bd576;--warn:#ffcc66;--err:#ff6b6b}
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(80rem 80rem at 120% -10%,#1a1c25 0%,#0b0c10 50%),#0b0c10;color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased}
    .wrap{max-width:860px;margin:6vh auto;padding:20px}
    h1{font-size:28px;letter-spacing:.2px;margin:0 0 6px}
    p.sub{margin:0 0 20px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:18px}
    .card{background:var(--card);border:1px solid #1e2027;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.3);padding:16px}
    .zone{border:1.5px dashed #2b2f3c;border-radius:14px;padding:18px;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;cursor:pointer;transition:.15s ease}
    .zone:hover{background:#141724;border-color:#3a4052}
    .zone input{display:none}
    .btn{appearance:none;border:0;background:linear-gradient(90deg,#00e1ff,#6ee7ff);color:#00131a;font-weight:800;border-radius:12px;padding:12px 16px;font-size:14px;cursor:pointer;transition:transform .06s ease}
    .btn:active{transform:translateY(1px)}
    .muted{color:var(--muted);font-size:13px}
    .preview{width:100%;aspect-ratio:4/3;background:#0f1117;border:1px solid #1f2330;border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .preview img{max-width:100%;max-height:100%;display:block}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .stack{display:flex;flex-direction:column;gap:10px}
    .out{font-family:ui-monospace,Menlo,Consolas,monospace;font-size:14px;background:#0f1117;border:1px solid #1f2330;border-radius:12px;padding:12px;white-space:pre-wrap;word-break:break-word;min-height:120px}
    .pill{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:6px 10px;font-size:12px;border:1px solid #2a2e3c;color:#b9c0d0}
    .ok{background:rgba(43,213,118,.12);border-color:rgba(43,213,118,.3);color:#c9f7da}
    .warn{background:rgba(255,204,102,.1);border-color:rgba(255,204,102,.35);color:#ffe1a3}
    .err{background:rgba(255,107,107,.1);border-color:rgba(255,107,107,.35);color:#ffd2d2}
    .progress{height:8px;background:#12141b;border:1px solid #1f2330;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#00e1ff,#6ee7ff)}
    .footer{margin-top:14px;color:#6b7280;font-size:12px}
    @media (max-width:880px){.grid{grid-template-columns:1fr;gap:14px}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Identify Device → Brand → Model</h1>
    <p class="sub">Upload one photo. We’ll try to detect the device type, brand, and likely model. If confidence is low, you’ll get a guided follow-up.</p>

    <div class="grid">
      <div class="card">
        <div id="drop" class="zone">
          <div class="pill">Drop image here or click</div>
          <button id="pick" class="btn">Choose Image</button>
          <input id="file" type="file" accept="image/*" />
          <div class="muted">JPG/PNG, up to ~8 MB</div>
        </div>

        <div class="stack" style="margin-top:14px">
          <div class="preview" id="preview"><span class="muted">No image selected</span></div>
          <div class="row">
            <button id="run" class="btn" disabled>Identify</button>
            <div class="pill" id="status">Idle</div>
          </div>
          <div class="progress"><div class="bar" id="bar"></div></div>
        </div>
      </div>

      <div class="card">
        <div class="row" style="margin-bottom:8px">
          <div class="pill">Result</div>
          <div class="pill" id="confPill">–</div>
        </div>
        <div class="out" id="out">Waiting for an image…</div>
        <div class="footer">We call <code>/api/identify</code> on your server. Keep your API keys server-side.</div>
      </div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById('file')
    const pickBtn = document.getElementById('pick')
    const drop = document.getElementById('drop')
    const preview = document.getElementById('preview')
    const runBtn = document.getElementById('run')
    const out = document.getElementById('out')
    const statusPill = document.getElementById('status')
    const bar = document.getElementById('bar')
    const confPill = document.getElementById('confPill')
    let currentFile = null
    function setStatus(t,c){statusPill.textContent=t;statusPill.className='pill '+(c||'')}
    function setConf(v){if(typeof v!=='number'){confPill.textContent='–';confPill.className='pill'}else{confPill.textContent='confidence '+(v*100).toFixed(0)+'%';confPill.className='pill '+(v>=0.8?'ok':v>=0.6?'warn':'err')}}
    function setBar(p){bar.style.width=Math.max(0,Math.min(100,p))+'%'}
    function showImage(file){const url=URL.createObjectURL(file);preview.innerHTML='';const img=new Image();img.onload=()=>URL.revokeObjectURL(url);img.src=url;preview.appendChild(img)}
    function dataUrlToBase64(u){return u.split(',')[1]||u}
    function resizeIfNeeded(file,maxW=1280,maxH=1280,quality=0.9){return new Promise((resolve)=>{const img=new Image();img.onload=()=>{const r=Math.min(maxW/img.width,maxH/img.height,1);if(r===1){resolve(file);return}const c=document.createElement('canvas');c.width=Math.round(img.width*r);c.height=Math.round(img.height*r);const ctx=c.getContext('2d');ctx.drawImage(img,0,0,c.width,c.height);c.toBlob(b=>{resolve(new File([b],'resized-'+file.name,{type:'image/jpeg'}))},'image/jpeg',quality)},img.onerror=()=>resolve(file);img.src=URL.createObjectURL(file)})}
    pickBtn.onclick=()=>fileInput.click()
    fileInput.onchange=async(e)=>{const f=e.target.files[0];if(!f)return;currentFile=await resizeIfNeeded(f);showImage(currentFile);runBtn.disabled=false;out.textContent='Ready. Click Identify.';setConf();setStatus('Ready')}
    ;['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.style.background='#141724'}))
    ;['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.style.background='' }))
    drop.addEventListener('drop',async e=>{const f=e.dataTransfer.files[0];if(!f)return;currentFile=await resizeIfNeeded(f);showImage(currentFile);runBtn.disabled=false;out.textContent='Ready. Click Identify.';setConf();setStatus('Ready')})
    runBtn.onclick=async()=>{if(!currentFile)return;setStatus('Uploading…');setBar(20);const b64=await new Promise((resolve,reject)=>{const r=new FileReader();r.onload=()=>resolve(dataUrlToBase64(r.result));r.onerror=reject;r.readAsDataURL(currentFile)});setStatus('Identifying…');setBar(55);try{const resp=await fetch('/api/identify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imageBase64:b64})});setBar(80);if(!resp.ok){setStatus('Error','err');setBar(0);out.textContent='Server error: '+resp.status;return}const json=await resp.json();setBar(100);setTimeout(()=>setBar(0),600);if(json.status==='ok'){setStatus('Identified','ok');setConf(json.confidence);out.textContent=JSON.stringify({type:json.type,brand:json.brand,model:json.model,confidence:json.confidence},null,2)}else if(json.status==='unsure'){setStatus('Need more info','warn');setConf(json.confidence||0);out.textContent=JSON.stringify({type:json.type||'device',brand:json.brand||'unknown',guessModel:json.guessModel||null,confidence:json.confidence||0,ask:json.ask},null,2)}else{setStatus('No device','err');setConf();out.textContent='No device was detected in this image.'}}catch(e){setStatus('Network error','err');setBar(0);setConf();out.textContent=String(e)}}
  </script>
</body>
</html>
